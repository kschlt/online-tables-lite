graph TB
    %% User Interaction Layer
    User["ğŸ‘¤ User"]
    Claude["ğŸ¤– Claude Code"]

    %% Trigger Detection
    Triggers["ğŸ“‹ CLAUDE.md Triggers<br/>â€¢ 'commit' â†’ make commit<br/>â€¢ 'push' â†’ make pr-workflow<br/>â€¢ 'create branch' â†’ make branch-new"]

    %% Central Dispatcher
    Makefile["âš™ï¸ Makefile<br/>(Central Dispatcher)"]

    %% Core Workflows
    CommitWF["ğŸ”„ Commit Workflow<br/>make commit"]
    BranchWF["ğŸŒ¿ Branch Workflow<br/>make branch-new"]
    PRWF["ğŸš€ PR Workflow<br/>make pr-workflow"]

    %% Agent Scripts Layer
    AgentScripts["ğŸ“ Agent Scripts<br/>./scripts/agent/"]

    %% Workflow Scripts
    CommitScript["ğŸ“ commit-workflow.sh"]
    PRScript["ğŸ”€ pr-workflow.sh"]
    DocsScript["ğŸ“š docs-workflow.sh"]

    %% Utilities & Support
    Utils["ğŸ”§ Utils<br/>â€¢ validate-branch-name.sh<br/>â€¢ validate-work-context.sh<br/>â€¢ workflow-cache.sh"]
    Promptlets["ğŸ“‹ Promptlets<br/>â€¢ promptlet-reader.sh<br/>â€¢ promptlets.json"]

    %% GitHub Integration
    GitHub["ğŸ™ GitHub<br/>â€¢ PRs<br/>â€¢ CI/CD<br/>â€¢ Branch Management"]

    %% Flow Connections
    User --> Claude
    Claude --> Triggers
    Triggers --> Makefile

    Makefile --> CommitWF
    Makefile --> BranchWF
    Makefile --> PRWF

    CommitWF --> AgentScripts
    BranchWF --> AgentScripts
    PRWF --> AgentScripts

    AgentScripts --> CommitScript
    AgentScripts --> PRScript
    AgentScripts --> DocsScript

    AgentScripts --> Utils
    AgentScripts --> Promptlets

    %% Ping-Pong Returns
    CommitScript -.->|"Promptlets"| Claude
    PRScript -.->|"Promptlets"| Claude
    DocsScript -.->|"Promptlets"| Claude

    %% External Integration
    PRScript --> GitHub

    %% Styling
    classDef userLayer fill:#e1f5fe
    classDef dispatchLayer fill:#f3e5f5
    classDef workflowLayer fill:#e8f5e8
    classDef agentLayer fill:#fff3e0
    classDef externalLayer fill:#fce4ec

    class User,Claude userLayer
    class Triggers,Makefile dispatchLayer
    class CommitWF,BranchWF,PRWF workflowLayer
    class AgentScripts,CommitScript,PRScript,DocsScript,Utils,Promptlets agentLayer
    class GitHub externalLayer