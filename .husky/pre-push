#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Production Protection Only
while read local_ref local_sha remote_ref remote_sha; do
    branch=$(echo "$remote_ref" | sed 's/refs\/heads\///')
    
    if [ "$branch" = "production" ]; then
        echo "🚨 PRODUCTION PUSH - Running essential checks..."
        
        # Quick web check
        cd apps/web
        if ! npm run typecheck > /dev/null 2>&1; then
            echo "❌ TypeScript errors detected!"
            echo "💡 Fix errors before pushing to production"
            exit 1
        fi
        
        if ! npm run build > /dev/null 2>&1; then
            echo "❌ Build failed!"
            echo "💡 Fix build issues before pushing to production"
            exit 1
        fi
        
        # Quick API check
        cd ../api
        if ! ruff check . > /dev/null 2>&1; then
            echo "❌ API linting errors detected!"
            echo "💡 Fix linting issues before pushing to production"
            exit 1
        fi
        
        echo "✅ Production checks passed - safe to deploy!"
    fi
done
