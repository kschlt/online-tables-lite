#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Production Protection Only
while read local_ref local_sha remote_ref remote_sha; do
    branch=$(echo "$remote_ref" | sed 's/refs\/heads\///')
    
    if [ "$branch" = "production" ]; then
        echo "ğŸš¨ PRODUCTION PUSH - Running essential checks..."
        
        # Quick web check
        cd apps/web
        if ! npm run typecheck > /dev/null 2>&1; then
            echo "âŒ TypeScript errors detected!"
            echo "ğŸ’¡ Fix errors before pushing to production"
            exit 1
        fi
        
        if ! npm run build > /dev/null 2>&1; then
            echo "âŒ Build failed!"
            echo "ğŸ’¡ Fix build issues before pushing to production"
            exit 1
        fi
        
        # Quick API check
        cd ../api
        if ! ruff check . > /dev/null 2>&1; then
            echo "âŒ API linting errors detected!"
            echo "ğŸ’¡ Fix linting issues before pushing to production"
            exit 1
        fi
        
        echo "âœ… Production checks passed - safe to deploy!"
    fi
done
