#!/usr/bin/env sh

# AI-Era Branch Protection
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$current_branch" = "main" ] || [ "$current_branch" = "production" ]; then
    # Check if this is a merge commit
    commit_msg=$(git log -1 --pretty=%B)
    
    if echo "$commit_msg" | grep -q "Merge branch"; then
        echo "âœ… Merge to $current_branch - ALLOWED"
    else
        echo ""
        echo "ğŸš¨ AI PROTECTION: Direct commits to $current_branch blocked!"
        echo ""
        echo "ğŸ’¡ Use feature branches:"
        echo "   git checkout -b feature/your-change"
        echo "   git commit -m 'your changes'"
        echo "   git checkout main && git merge feature/your-change"
        echo ""
        echo "ğŸ›¡ï¸  This prevents accidental direct commits to protected branches."
        exit 1
    fi
else
    echo "âœ… Committing to feature branch: $current_branch"
    echo "ğŸ” AI protection: ACTIVE"
fi
